---
title: "P8130_hw3"
author: "bowen xia"
date: "2025-10-14"
output: github_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

#problem 1
```{r}
library(MASS)
data(birthwt)

smoke_yes <- birthwt$lwt[birthwt$smoke == 1]
smoke_no <- birthwt$lwt[birthwt$smoke == 0]

# Part (a): Test for equality of variances at α = 0.05
var_test <- var.test(smoke_yes, smoke_no)
print(var_test)

# Part (b): Decision based on variance test
# If p-value > 0.05, use pooled variance t-test
# If p-value ≤ 0.05, use Welch's t-test

# Part (c): Hypothesis test at α = 0.10
if(var_test$p.value > 0.05) {
  # Equal variances - use pooled t-test
  t_test <- t.test(smoke_yes, smoke_no, var.equal = TRUE, 
                   alternative = "two.sided", conf.level = 0.90)
} else {
  t_test <- t.test(smoke_yes, smoke_no, var.equal = FALSE, 
                   alternative = "two.sided", conf.level = 0.90)
}
print(t_test)

# Part (d): 95% CI for difference in means
ci_95 <- t.test(smoke_yes, smoke_no, var.equal = (var_test$p.value > 0.05), 
                conf.level = 0.95)
print(ci_95$conf.int)
```

#problem2
```{r}
# Part (a): 95% CI for rate of uterine irritability among smokers
ui_smokers <- birthwt$ui[birthwt$smoke == 1]
n_smokers <- length(ui_smokers)
x_smokers <- sum(ui_smokers)
p_hat_smokers <- x_smokers / n_smokers

prop_test_smokers <- prop.test(x_smokers, n_smokers, conf.level = 0.95)
print(prop_test_smokers)

# Part (b): 95% CI for difference in rates
ui_nonsmokers <- birthwt$ui[birthwt$smoke == 0]
n_nonsmokers <- length(ui_nonsmokers)
x_nonsmokers <- sum(ui_nonsmokers)

prop_test_diff <- prop.test(c(x_smokers, x_nonsmokers), 
                             c(n_smokers, n_nonsmokers), 
                             conf.level = 0.95)
print(prop_test_diff)

# Part (c): Hypothesis test at α = 0.01
prop_test_hyp <- prop.test(c(x_smokers, x_nonsmokers), 
                            c(n_smokers, n_nonsmokers), 
                            conf.level = 0.99)
print(prop_test_hyp)
cat("p-value:", prop_test_hyp$p.value, "\n")
cat("Decision: ", ifelse(prop_test_hyp$p.value < 0.01, 
                         "Reject H0", "Fail to reject H0"), "\n")
```


#problem3
```{r}
# Part (a): Most appropriate test - ANOVA (comparing means across >2 groups)

# Part (b): Check assumptions
# 1. Independence - assumed from study design
# 2. Normality - check with Shapiro-Wilk or QQ plots
# 3. Equal variances - check with Levene's test

library(car)

race1 <- birthwt$bwt[birthwt$race == 1]
race2 <- birthwt$bwt[birthwt$race == 2]
race3 <- birthwt$bwt[birthwt$race == 3]

shapiro.test(race1)
shapiro.test(race2)
shapiro.test(race3)

leveneTest(bwt ~ as.factor(race), data = birthwt)

# Part (c): ANOVA test at α = 0.05
anova_result <- aov(bwt ~ as.factor(race), data = birthwt)
summary(anova_result)

# Part (d): Multiple comparisons (Tukey HSD)
tukey_result <- TukeyHSD(anova_result, conf.level = 0.95)
print(tukey_result)

plot(tukey_result)
```